<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Полярная викторина в стиле Что? Где? Когда?</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding: 20px; }
  #question { font-weight: bold; margin-bottom: 10px; }
  #answers label { display: block; margin: 5px 0; }
  img { max-width: 100%; margin-top: 10px; }
  #timer { font-weight: bold; color: red; }
  #nextBtn { margin-top: 10px; padding: 10px 20px; }
</style>
</head>
<body>

<h1>Полярная викторина в стиле Что? Где? Когда?</h1>

<div id="userData">
  <p>Пожалуйста, укажите ваши данные перед началом викторины:</p>
  <label>Имя: <input type="text" id="firstName"></label><br>
  <label>Фамилия: <input type="text" id="lastName"></label><br>
  <label>Контакт (ссылка на источник): <input type="text" id="contact"></label><br><br>
  <button id="startBtn">Начать викторину</button>
</div>

<div id="quiz" style="display:none;">
  <p id="timer">2:00</p>
  <div id="question"></div>
  <div id="answers"></div>
  <button id="nextBtn">Следующий вопрос</button>
</div>

<div id="result" style="display:none;">
  <h2>Результат викторины</h2>
  <p id="score"></p>
</div>

<script>
// ------------------- Массив вопросов -------------------
const questions = [
  { type: "choice", text: "Вопрос 1. Что, по мнению многих полярников, является лучшим ледоколом?", options: ["Ледокол «50 лет Победы»","Ветер","Айсберг","Солнце"], correct: "Ветер", points: 1 },
  { type: "choice", text: "Вопрос 2. Как известно, Антарктида является единственной территорией на планете, которая не принадлежит никому. Более того, на ней запрещено вести какую-либо военную деятельность, размещать воинские части и оружие. Но исторически так сложилось, что в Антарктиде, на российских станциях всё же празднуется один военный праздник. И в данном случае это не 9 мая и не 23 февраля. А что же это за праздник?", options: ["День военно-морского флота","День Авиации","День Десантника","День Танкиста"], correct: "День Танкиста", points: 2 },
  { type: "choice", text: "Вопрос 3. Какой известный полярник является автором данной цитаты:\n\n«Цель достигнута, путешествие закончено. Не могу сказать, хотя знаю, что прозвучало бы куда эффектнее, — что я достиг цели своей жизни. Это было бы уж явной и откровенной выдумкой. Лучше буду честен и скажу прямо, что, по-моему, ещё никогда никто из людей не стоял в точке, диаметрально противоположной цели его стремлений в таком полном смысле слова, как я в этом случае…»", options: ["Фритьоф Нансен","Георгий Седов","Руаль Амундсен","Роберт Пири"], correct: "Руаль Амундсен", points: 2 },
  { type: "choice", text: "Вопрос 4. Австро-Венгерская экспедиция под командованием Юлиуса Пайера и Карла Вайпрехта проходила в 1871–1874 гг. на судне «Адмирал Тегетгоф». Целью экспедиции являлся проход по Северному морскому пути, однако корабль был затёрт во льдах и более года дрейфовал. Во время дрейфа был открыт архипелаг Земля Франца Иосифа.\n\nЮлиус Пайер писал, что во время зимовки для экипажа проводились занятия прямо на палубе под тентом. Однако часто ученикам было не видно то, что преподаватель пишет на доске. По какой причине?", options: ["Было темно","Пар изо рта полярников ухудшал видимость","Был плохой мел"], correct: "Пар изо рта полярников ухудшал видимость", points: 3 },
  { type: "choice", text: "Вопрос 5. ОНА воображаема, как и её сестра, причём имя ЕЁ — мужского рода. А вот автор вопроса очень часто обозначает её при помощи двух чисел. Одно из этих чисел больше другого ровно в два раза.\n\nКто ОНА?", options: ["Меридиан","Экватор","Тропик","Полярный круг"], correct: "Полярный круг", points: 2 },
  { type: "choice", text: "Вопрос 6. Главный герой сериала «Настоящий детектив» назвал ЭТО «короной». Хотя для людей приписывание такой короны — не самая приятная учесть. А ещё ЭТО можно найти, просто гуляя по арктической тундре.\n\nА кому ЭТО принадлежит?", options: ["Белому медведю","Оленю","Чайке","Полярнику"], correct: "Оленю", points: 2 },
  { type: "choice", text: "Вопрос 7. В 1865 году, основываясь на изучении течений и дрейфа льдов Северного Ледовитого океана, русский морской офицер Николай Густавович Шиллинг выдвинул одну гипотезу, которая через восемь лет была подтверждена австро-венгерскими исследователями. Попробуйте догадаться, что предсказал или нашёл Шиллинг?", options: ["Предсказал глобальное потепление","Нашёл рыбные места","Предсказал наличие земли между Новой Землёй и Шпицбергеном","Отыскал пропавшую экспедицию"], correct: "Предсказал наличие земли между Новой Землёй и Шпицбергеном", points: 3 },
  { type: "choice", text: "Вопрос 8. Перед вами фотография, сделанная в одной полярной экспедиции. Несмотря на то, что главная цель этой экспедиции была достигнута, она всё равно в итоге оказалась неудачной, и даже трагичной. И как ни странно, одной из главных причин неудачи многие историки связывают с тем, что изображено на этой фотографии.\n\nЧто это была за экспедиция?", image: "images/IMG_4755.JPG", options: ['Экспедиция "Терра Нова" Роберта Скотта',"Экспедиция Франклина 1845—1847 годов",'Норвежская полярная экспедиция (1893—1896) на "Фраме"',"Австралийская антарктическая экспедиция Дугласа Моусона"], correct: 'Экспедиция "Терра Нова" Роберта Скотта', points: 2 },
  { type: "text", text: "Вопрос 9. Как называется район Москвы, флаг которого здесь изображён?", image: "images/Flag_of_Severnoye_Medvedkovo_District_(Moscow).svg.png", correct: "Северное Медведково", points: 2 },
  { type: "text", text: "Вопрос 10. Латинское название этих животных буквально означает «ходячий на зубах». А ещё в честь них иногда называют определённую группу людей.", correct: ["Морж", "Моржи"], points: 2 },
  { type: "text", text: "Вопрос 11. В честь него названы пролив, остров, глубоководная впадина, кратер на Марсе и даже футбольный клуб в Норвегии. Вообще в Норвегии в честь него много чего называли. Причём это даже не человек. А что же это тогда?", correct: "Фрам", points: 3 },
  { type: "text", text: "Вопрос 12. В 1867 году два государства заключили договор на покупку и продажу некоторой недвижимости, которую газеты впоследствии прозвали «Джонсоновским зоопарком белых медведей». Что это была за недвижимость?", correct: ["Аляска", "полуостров Аляска"], points: 3 },
  { type: "text", text: "Вопрос 13. Ледокол «Святогор» был построен в городе Ньюкасл в 1917 году. В том же году на нём был поднят Андреевский флаг, и ледокол вошёл в состав флота Российской империи. В 1918 году «Святогор» был затоплен в дельте Северной Двины для препятствования кораблям английских интервентов. В феврале 1920 года интервенты отступили, забрав с собой ледокол в Англию. В 1922 году советскому правительству удалось выкупить «Святогор». Назовите фамилию дипломата, организовавшего возвращение ледокола в Россию.", correct: "Красин", points: 3 },
  { type: "text-multiple", text: "Вопрос 14. Ниже перечислены 5 разных имён. Из этих имён вы можете расшифровать 4 географических объекта, расположенных в Арктике. Объекты имеют общую сущность. Назовите эти объекты:\n\nХаритон, Карина, Френсис, Дмитрий, Уиллем", correct: ["море Бофорта","море Лаптевых","Карское море","Баренцево море"], points: 4 },
  { type: "text", text: "Вопрос 15. Перед вами герб одной северной провинции. Как видите, на ней изображён мужик с дубиной. А ещё эта провинция является родиной другого мужика, у которого обычно дубины нет. Зато \"дубина\" есть у его коллеги из соседней страны.\n\nГерб какой провинции изображён на картинке?", image: "images/Снимоквы.JPG", correct: "Лапландия", points: 5 }
];

// ------------------- ПЕРЕМЕННЫЕ -------------------
let current = 0;
let score = 0;
let timer;
let timeLeft = 120;

// ★ ДОБАВЛЕНО
let userAnswers = [];
let userFirstName = "";
let userLastName = "";
let userContact = "";

// ------------------- HTML -------------------
const startBtn = document.getElementById("startBtn");
const userDataDiv = document.getElementById("userData");
const quizDiv = document.getElementById("quiz");
const questionText = document.getElementById("question");
const answers = document.getElementById("answers");
const nextBtn = document.getElementById("nextBtn");
const timerDisplay = document.getElementById("timer");
const resultDiv = document.getElementById("result");
const scoreDisplay = document.getElementById("score");

// ------------------- СТАРТ -------------------
startBtn.onclick = () => {
  userFirstName = document.getElementById("firstName").value.trim();
  userLastName = document.getElementById("lastName").value.trim();
  userContact = document.getElementById("contact").value.trim();

  if (!userFirstName || !userLastName || !userContact) {
    alert("Пожалуйста, заполните все поля.");
    return;
  }

  userDataDiv.style.display = "none";
  quizDiv.style.display = "block";
  loadQuestion();
};

// ------------------- ЗАГРУЗКА ВОПРОСА -------------------
function loadQuestion() {
  if (current >= questions.length) {
    finishQuiz();
    return;
  }

  const q = questions[current];
  questionText.innerHTML = q.text;
  answers.innerHTML = "";

  if (q.image) {
    const img = document.createElement("img");
    img.src = q.image;
    questionText.appendChild(document.createElement("br"));
    questionText.appendChild(img);
  }

  if (q.type === "choice") {
    q.options.forEach(opt => {
      const label = document.createElement("label");
      label.innerHTML = `<input type="radio" name="answer" value="${opt}"> ${opt}`;
      answers.appendChild(label);
    });
  } else {
    answers.innerHTML = `<input type="text" id="textAnswer" style="width:100%">`;
  }

  timeLeft = 120;
  timerDisplay.textContent = "2:00";
  clearInterval(timer);

  timer = setInterval(() => {
    timeLeft--;
    const m = Math.floor(timeLeft / 60);
    const s = timeLeft % 60;
    timerDisplay.textContent = `${m}:${s < 10 ? "0"+s : s}`;
    if (timeLeft <= 0) {
      clearInterval(timer);
      nextQuestion();
    }
  }, 1000);
}

// ------------------- ПОДСЧЁТ БАЛЛОВ -------------------
function calculatePoints(q, answer) {
  if (!answer) return 0;

  if (q.type === "choice") return answer === q.correct ? q.points : 0;

  if (q.type === "text") {
    if (Array.isArray(q.correct)) {
      return q.correct.some(c => c.toLowerCase() === answer.toLowerCase()) ? q.points : 0;
    }
    return answer.toLowerCase() === q.correct.toLowerCase() ? q.points : 0;
  }

  if (q.type === "text-multiple") {
    const arr = answer.split(",").map(a => a.trim().toLowerCase());
    let pts = 0;
    q.correct.forEach(c => { if (arr.includes(c.toLowerCase())) pts++; });
    return pts;
  }

  return 0;
}

// ------------------- СЛЕДУЮЩИЙ ВОПРОС -------------------
nextBtn.onclick = nextQuestion;

function nextQuestion() {
  clearInterval(timer);
  const q = questions[current];
  let answer = "";

  if (q.type === "choice") {
    const sel = document.querySelector('input[name="answer"]:checked');
    if (sel) answer = sel.value;
  } else {
    answer = document.getElementById("textAnswer").value.trim();
  }

  const earned = calculatePoints(q, answer);
  score += earned;

  // ★ ДОБАВЛЕНО — сохраняем статистику
  userAnswers.push({
    number: current + 1,
    question: q.text,
    userAnswer: answer || "(нет ответа)",
    correctAnswer: Array.isArray(q.correct) ? q.correct.join(", ") : q.correct,
    points: earned
  });

  current++;
  loadQuestion();
}

// ------------------- ФИНИШ -------------------
function finishQuiz() {
  quizDiv.style.display = "none";
  resultDiv.style.display = "block";

  const maxScore = questions.reduce((a,q)=>a+q.points,0);
  scoreDisplay.textContent = `Вы набрали ${score} баллов из возможных ${maxScore}.`;

  // ★ ОТПРАВКА НА GOOGLE SCRIPT
  fetch("https://script.google.com/macros/s/AKfycbyISPyaKozX2rPLUoQo28FgeU82wuc_q3mmVP5osKhOgYGCW5oW5kgw1EW5Du06VlSO/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      firstName: userFirstName,
      lastName: userLastName,
      contact: userContact,
      score: score,
      maxScore: maxScore,
      answers: userAnswers
    })
  }).catch(err => console.error(err));
}
</script>

</body>
</html>


